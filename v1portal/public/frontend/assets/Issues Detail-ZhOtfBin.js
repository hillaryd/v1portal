var f=(_,t,i)=>new Promise((e,d)=>{var m=o=>{try{n(i.next(o))}catch(c){d(c)}},u=o=>{try{n(i.throw(o))}catch(c){d(c)}},n=o=>o.done?e(o.value):Promise.resolve(o.value).then(m,u);n((i=i.apply(_,t)).next())});import{L as N}from"./LeftSidebar-Bv_zMSK0.js";import{_ as R,b as L,r as l,c as P,q as F,o as U,e as k,f as r,g,n as S,t as H,x as q,v as j,u as J,y as M,h as v,i as y}from"./index-59s5irdc.js";import{_ as A}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-C_ouJCLj.js";import{a as G,b as K}from"./FormControl.vue_vue_type_script_setup_true_lang-DN1lN8V8.js";import{T as Q}from"./TextEditor-Bn_i_fGS.js";import"./Avatar.vue_vue_type_script_setup_true_lang-Dt0vLd5E.js";import"./index-CFFX3Mdj.js";const W={components:{LeftSidebar:N,Breadcrumbs:A,Button:L,FormControl:G,TextEditor:Q,Textarea:K},setup(){const _=J(),t=M(),i=l(!1),e=l(!1),d=l(""),m=l(""),u=l(""),n=l(""),o=l(""),c=l(""),h=l([]),p=l([]),B=P({url:"v1portal.v1portal.api.api.get_issues",method:"get"}),C=l([{label:"Issues",route:{name:"issue"}},{label:"New",route:{}}]),T=[{label:"Open",value:"Open"},{label:"Closed",value:"Closed"},{label:"Replied",value:"Replied"},{label:"On Hold",value:"On Hold"},{label:"Resolved",value:"Resolved"}],w=()=>f(this,null,function*(){try{const s=t.params.id,a=(yield B.fetch()).find(O=>O.name===s);a&&(d.value=a.name,c.value=a.subject,m.value=a.status,u.value=a.description.replace(/<\/?[^>]+>/gi,""),o.value=a.customer,n.value=a.priority)}catch(s){console.error("Error fetching issue details:",s)}}),V=()=>{e.value=!0},z=()=>{e.value=!1,w()},D=()=>f(this,null,function*(){const s=t.params.id;if(!s)return;const b={subject:c.value,status:m.value,priority:n.value,description:u.value,customer:o.value};try{if(!(yield fetch(`/api/resource/Issue/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)})).ok)throw new Error("Error updating issue");e.value=!1,_.push({name:"issue"})}catch(a){console.error("Error updating issue:",a)}}),x=()=>f(this,null,function*(){try{const s=yield fetch('/api/resource/Customer?fields=["name"]');if(!s.ok)throw new Error("Network response was not ok");const b=yield s.json();h.value=b.data.map(a=>a.name)||[]}catch(s){console.error("Error fetching customers:",s)}}),E=()=>f(this,null,function*(){try{const s=yield fetch('/api/resource/Issue Priority?fields=["name"]');if(!s.ok)throw new Error("Network response was not ok");const b=yield s.json();p.value=b.data.map(a=>a.name)||[]}catch(s){console.error("Error fetching customers:",s)}}),I=()=>{i.value=!i.value};return F(d,s=>{C.value[1].label=s}),U(()=>f(this,null,function*(){yield w(),yield x(),yield E()})),{isSidebarCollapsed:i,priorityOption:p,isEditing:e,name:d,status:m,subject:c,description:u,priority:n,customer:o,customOption:h,toggleSidebar:I,breadcrumbsList:C,statusOptions:T,optionsCustomer:x,optionsPriority:E,startEditing:V,cancelEditing:z,submitChanges:D}}},X={class:"head-content"},Y={class:"border-b bg-white h-12 py-2.5 pb-[2.625rem] sm:px-5 mb-12"},Z={class:"main-content",style:{"padding-left":"150px","padding-right":"150px"}},$={class:"bg-white border rounded-lg p-6 space-y-6 pb-[2.625rem]"},ee={class:"float-left mb-1 text-9xl font-bold text-gray-800 -mt-2",style:{"font-size":"1.85rem"}},se={class:"text-9xl font-bold text-gray-600",style:{"font-size":"1rem"}},te={class:"float-right mb-1"},oe={class:"p-2"},ae={key:0,class:"float-right flex gap-4"};function re(_,t,i,e,d,m){const u=v("Breadcrumbs"),n=v("LeftSidebar"),o=v("Button"),c=v("FormControl"),h=v("Textarea");return y(),k("div",null,[r("div",{class:S(["head-layout",{collapsed:e.isSidebarCollapsed}])},[r("div",X,[r("header",Y,[g(u,{items:e.breadcrumbsList,class:"float-left"},null,8,["items"])])])],2),r("div",{class:S(["layout",{collapsed:e.isSidebarCollapsed}])},[g(n,{isCollapsed:e.isSidebarCollapsed,onToggle:e.toggleSidebar},null,8,["isCollapsed","onToggle"]),r("div",Z,[r("div",$,[r("div",ee,[t[2]||(t[2]=r("p",null,"Issue",-1)),r("p",se,H(e.subject),1)]),r("div",te,[e.isEditing?j("",!0):(y(),q(o,{key:0,variant:"solid",theme:"gray",size:"md",label:"Edit",disabled:!1,onClick:e.startEditing,class:""},null,8,["onClick"]))]),t[4]||(t[4]=r("div",{class:"border-b pb-7 pt-8"},null,-1)),r("div",oe,[g(c,{type:"text",size:"md",variant:"subtle",placeholder:"subject",disabled:!e.isEditing,label:"Subject",modelValue:e.subject,"onUpdate:modelValue":t[0]||(t[0]=p=>e.subject=p),class:"mb-5"},null,8,["disabled","modelValue"]),r("div",null,[t[3]||(t[3]=r("label",{class:"block text-base mb-2 text-gray-600",for:"frappe-ui-1"},"Description",-1)),g(h,{type:"textarea",size:"sm",variant:"subtle",placeholder:"Placeholder",disabled:!e.isEditing,label:"Description",class:"mb-5 h-[200px]",modelValue:e.description,"onUpdate:modelValue":t[1]||(t[1]=p=>e.description=p)},null,8,["disabled","modelValue"])]),e.isEditing?(y(),k("div",ae,[g(o,{variant:"subtle",theme:"gray",size:"md",label:"Discard",disabled:!1,onClick:e.cancelEditing},null,8,["onClick"]),g(o,{variant:"solid",theme:"gray",size:"md",label:"Submit",disabled:!1,onClick:e.submitChanges},null,8,["onClick"])])):j("",!0)])])])],2)])}const be=R(W,[["render",re],["__scopeId","data-v-8f970d05"]]);export{be as default};
